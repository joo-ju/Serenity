# 2장_하이퍼레저 패브릭 개요

## 2.1  하이퍼레저 프로젝트란?

### 하이퍼레저 소투스

- PoET(Proof of Elapsed Time) 컨센서스 알고리즘이 적용된 분산원장 프레임워크로 인텔의 SGX(Secure Guard Extensions) 기술을 기반으로 구현
- On-Chain Governance(온 체인 거버넌스)와 같은 기능 제공
- On-Chain Governance(온 체인 거버넌스)
    - 권한이 부여된 사용자가 블록 구성 설정에 투표할 수 있도록 자체 스마트 컨트랙트를 구현할 수 있는 환경을 제공
    - 거버넌스를 통제, 운영할 수 있음.
    - Permissioned Blockchain과 Permissionless Blockchain을 모두 지원해 다양한 거버넌스 환경 구성 가능

- 블록체인 네트워크 전반의 높은 확장성과 모듈화를 추구
- PoET 컨센서스 알고리즘을 제공하여 블록체인 네트워크 상의 효율성, 합리성 강화
- 음악 및 미디어 콘텐츠 저작구너 분배, 헬스케어 거래 기록, 금융 서비스 내 KYC 등의 산업 분야에서 개념증명 파일럿 프로젝트가 진행중

### 하이퍼레저 이로하

- 모바일 애플리케이션 개발에 초점을 둔 분산원장 개발 프로젝트
- C++ 디자인 기반, BTF(Byzantine Fault Tolerant) 컨센서스 알고리즘을 이용
- 디지털 자산, ID, 일련번호가 지정된 데이터를 관리하는데 최적화 됨.
- 은행 간 결제, 중앙 은행 디니털 통화, 지불 시스템 등과 같은 애플리케이션을 편리하게 개발
- 모바일과 웹 기술을 동시에 지원해 모바일 인터페이스와 같은 UI/UX에도 많은 기능을 제공
- 고성능이며, 낮은 대기 시간을 가진 YAC(Yet Another Consensus) 컨센서스 알고리즘을 사용
- 전체 시스템에 대한 접근 및 통제를 강화하여 블록체인 시스템의 전반적인 보안 향상

### 하이퍼레저 패브릭

- 모듈러 아키텍처 기반의 애플리케이션/솔루션 개발 프레임워크
- 핵심 기술 요소를 Plug-and-Play(플러그 앤 플레이)방식으로 구현하도록 지원
- 컨테이너 기술을 활용해 시스템의 애플리케이션 로직을 구성할 수 있도록 체인코드 서비스를 제공
- 원장 데이터를 다양한 형식으로 저장 가능
- 컨센서스 알고리즘 전환 가능
- 블록체인 네트워크에 대한 참여 미 권한 관리를 위한 서명, 확인, 인증 방법도 MSP 서비스를 통해 다양한 확장성 제공
- 하이퍼레저 패브릭 프로젝트 목표
    - 허가된 참여자를 대상으로 하는 비즈니스 응용 환경에 맞는 블록체인
    - 다양한 요구사항을 가진 분산 응용 서비스를 효율적으로 지원할 수 있는 개발 플랫폼
    - 모듈러 아키텍쳐 기반 분산 응용 플랫폼(컨센서스 알고리즘, 멤버십 서비스 등이 모듈을 필요에 따라 교체 가능)
- 하이퍼레저 5가지 특징
    1. Permissioned Blockchain
        - MSP(Membership Service Provider)를 통해 허가된 참여자만 접근 허용, 접근 권한 제어 가능
        - 폐쇠망 형태의 프라이빗 블록체인을 구성
    2. 일반 프로그래밍 언어 사용
        - 비 결정적 프로그래밍 언어 사용
        - 스마트 컨트랙트의 결과가 항상 동일하지 않지만 내부 키의 상태 변환 값에 의해 비 결정적 오류를 해결
    3. 높은 성능
        - 키에 대한 버전관리를 통해 동시 처리에 따른 비 결정적 실행 문제점을 해결해 높은 성능을 낼 수 있음
    4. 교체 가능한 모듈러 아키텍쳐
        - 모듈형 구조이므로 오더링 서비스 노드에서 순서화를 통해 3가지 컨센서스 알고리즘을 선택(Solo, 카프카, PBFT)
    5. 멀티 블록체인 지원
        - 채널 이라는 분할된 네트워크로 멀티 블록체인을 지원
        - 논리적으로 독립된 여러 개의 블록체인으로 분할 할 수 있음

### 하이퍼레저 버로우

- EVM(Ethereum Virtual Machine)에 기반한 스마트 컨트랙트 인터프리터를 내장해 블록체인 클라이언트 서비스 제공
- 하이퍼레저의 확장성을 끌어올림 → 가장 기대되는 프로젝트

### 하이퍼레저 인디

- 인증에 특화된 프로젝트
- 독립적인 디지털 아이덴티티 레코드를 생성하고 사용할 수 있도록 각종 툴 및 라이브러리, 재사용 컴포넌트 제공
- 관리 도메인, 애플리케이션 등 서로 구분된 시스템 영역을 드나들면서 사용 가능

### 하이퍼레저 그리드

- 기업용 모듈러 소프트웨어와 스마트 컨트랙트 구성요소를 제공
- 라이브러리 세트와 데이터 모델, SDK(Software Development Kit)가 포함

### 하이퍼레저 컴포저

- 비즈니스 유스케이스를 신속하게 개발, 개발된 블록체인 네트워크와 애플리케이션을 쉽고 간편하게 배포
- 기존 시스템 및 데이터를 블록체인 애플리케이션과 쉽게 통합할 수 있다.
- 하이퍼레저 패브릭의 블록체인 인프라 및 런타임을 지원
- 기존 자산 및 관련 트랜잭션이 포함된 현재 비즈니스 네트워크를 블록체인 네트워크 상으로 신속하게 구현 가능

### 하이퍼레저 캘리퍼

- 블록체인 프레임워크를 위한 벤치마크 도구
- 다양한 블록체인 인프라를 진단에 사용
- TPS, 트랜잭션 대기시간, 리소스 사용률 등과 같은 다양한 성능지표를 포함하는 보고서를 생성

### 하이퍼레저 기타 도구

- 하이퍼레저 첼로 : 맞춤형 서비스 배포 모델을 블록체인에 적용해 블록체인 생성, 관리 및 종료시간을 최소화
- 하이퍼레저 익스플로러 : 블록체인 네트워크에 저장된 각종 정보를 수집하고 분석한 모니터링 도구
- 하이퍼레저 퀄트 : 분산원장과 비 분산원장 사이의 연결을 위해 설계된 ILP를 구현, 블록체인 간의 상호호환성을 제공
- 하이퍼레저 우르사 : 모듈식 크립토 개발 툴박스, 오픈소스로 기술 공유 가능

---

## 2.2  하이퍼레저 패브릭 아키텍쳐

- 신원확인
    - 권한을 가진 참여자만 분산원장에 데이터를 기록, 수정, 삭제 가능
    - MSP를 통해 신원을 확인
- 원장
    - 블록에 트랜잭션(거래) 정보가 실제로 저장되는 공간
    - 블록체인의 데이터를 관리하는 분산원장 데이터베이스
    - 하이퍼레저 패브릭에서는 한 채널이 원장을 가짐, 체널 안에 속한 피어 노드는 동일한 원장의 복사본을 가지고 있음.
- 트랜잭션
    - 스마트 컨트랙트인 체인코드의 실행을 의미함
- 체인코드
    - 프라이빗 블록 체인에서 활용할 수 있도록 비즈니스 로직을 구현할 수 있음

- 하이퍼레저 패브릭 핵심 용어
    - 채널 : 네트워크에서 구성 요소 간 그룹을 나눠 트랜잭션을 수행해야 할 때 사용. 트랜잭션의 접근 권한을 그룹별로 설정하고 관리함.
    - 조직 : 네트워그는 조직단위로 구성되어 있음. 조직 별로 피어 노드 관리 및 권한 부여, 보증 정책 등을 수행하며, 클라이언트(네트워크 참여자)의 접근권한도 관리
    - 피어 노드 : 블록체인 네트워크를 유지, 트랜잭션의 제안 및 응답을 처리, 체인코드를 관리하고 저장
        - 엔도싱 피어 노드 : 보증 정책에 따라 요청된 트랜잭션을 먼저 실행해보는 검토 역할을 수행한 후 트랜잭션에 트랜잭션 보증 사인을 첨부
        - 커미팅 피어 노드 : 엔도싱 피어 노드가 실행한 트랜잭션 결과를 검증 문제가 없으면 트랜잭션을 확정하고 그 내용을 블록체인에 업데이트 함.
        - 앵커 피어 노드 : 채널 내에서 대표 역할
        - 리더 피어 노드 : 조직에서 모든 피어 노드를 대표
    - 오더링 서비스 노드
        - 네트워크 내의 채널에 대한 구성 정보를 소유하고 이를 기반으로 전체 시스템의 관리자 역할을 수행
        - 클라이언트로부터 트랜잭션을 제안 받으면, 시간 순서에 따라 차례로 정리해 피어 노드에게 전달
        - Solo 오더링 서비스
            - 개발자가 블록체인 네트워크를 구성할 때 쉽고 간단하게 이용할 수 있도록 만들어진 오더링 서비스
            - 테스트 용도로 사용
            - 싱글 프로세스로 구성, 가용성이나 확장성 X
        - 카프카 기반 오더링 서비스
            - 시스템의 결함으로 인해 피어 노드가 멈췄을 때 다른 분산 오더링 서비스 제공
            - 높은 처리량과 고가용성 제공
            - 비잔티움문제에 노출됨
        - RAFT 오더링 서비스
            - CFT 알고리즘 기반 오더링 서비스
            - 하이퍼레저 패브릭 자체에 내장 된 기술이므로 카프카 기반 오더링 서비스보다 구축이나 관리가 용이함.
    - MSP
        - 블록체인 네트워크에 인증 서비스를 제공
        - 책임성(행위를 추적) 보장, 프라이버시(트랜잭션 익명성, 트랜잭션 비연결성) 보장
        - 각 노드의 신원, 역할, 소속, 권한을 관리하고 조직 구조를 설계
        - 클라이언트의 신원을 확인하고 접근 권한을 제공
    - CA
        - MSP에서 암호화 인증을 위해 필요한 인증기관
        - 블록체인을 구성하는 조직에게는 루트 인증서, 블록체인 네트워크에 접속하는 사용자에게는 신원 등록 인증서를 발급

    ### 하이퍼레저 패브릭 시스템 플로우

    1. 애플리케이션에서 스마트 컨트랙트를 위한 트랜잭션을 시작할 때, 먼저 트랜잭션 제안설르 엔도싱 피어 노드에게 보낸다. 트랜잭션 제안서에는 클라이언트의 ID, 트랜잭션을 제출하는 클라이언트의 서명 등의 내용이 포함되어 있음
    2. 제안서를 받은 엔도싱 피어 노드는 보증 정책에 따라 트랜잭션 제안서가 잘 구성돼 있는지 확인하고 서명이 유효한지를 체크한 후 체인코드를 실행. 이후 RW세트를 포함하는 트랜잭션 결과를 생성해 반환함. Read세트에는 시뮬레이션 중에 트랜잭션이 읽는 고유 키 및 커밋된 버전의 목록을 포함하며, Write세트에는 고유 키 목록과 트랜잭션이 작성하는 새 값 목록을 포함한다. Write 세트에는 고유 키 목록과 트랜잭션이 작성하는 새 값 목록을 포함한다.  애플리케이션은 엔도싱 피어 노드 서명을 확인하고, 각 엔도싱 피어 노드로부터 받은 응답 값이 동일한지 대조해 해당 트랜잭션에 대한 보증을 확보
    3. 전체 엔도싱 피어 노드들로부터 반환된 보증 요청의 결과 값들이 동일함을 확인해 해당 트랜잭션의 신뢰성을 확보했으면, 클라이언트 애플리케이션은 트랜잭션을 RW세트와 함께 엔도싱 피어 노드들의 서명, 채널 ID를 오더링 서비스 노드에 전송한다. 오더링 서비스 노드는 이미 앞에서 검증이 마무리됐기 때문에 트랜잭션 수행을 위해 전체 내용을 검사하지 않고 트랜잭션이 들어오는 순서만 정렬한다.
    4. 오더링 서비스 노드에서 생성된 트랜잭션 블록을 엔도싱 피어 노드와 커미팅 피어 노드에게 전달. 각 피어 노드는 보증 정책이 충족됐는지 확인한 후에 원장 상태가 변경됐는지 확인
    5. 엔도싱 피어 노드와 커미팅 피어 노드는 RW세트가 현재 월드 스테이트 상태와 여전히 일치하는지 확인해 트랜잭션의 유효성을 검사한다. 트랜잭션이 유효성 검사에 실패하면, 피어 노드는 RW 세트가 현재 월드 스테이트 상태와 일치하지 않는다는 것을 알린다. 블록에 기록된 트랜잭션은 무효로 기록하고, 월드 스테이트를 업데이트 하지 않는다.
    6. 유효성이 검증된 트랜잭션은 몯느 피어 노드의 데이터베이스에 기록된다. 이후 트랜잭션의 성공 또느 ㄴ실패 이벤틀르 클라이언트 애플리케이션에 알린다.